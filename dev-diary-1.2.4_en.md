# v1.2.4 Dev Diary: Build Pitfalls and Architectural Trade-offs

## Foreword

The journey to release v1.2.4 was filled with challenges and trade-offs. As a cross-platform application (macOS & Windows), while striving for native experience and high performance, we inevitably encountered platform-specific limitations. This diary records two major "pitfalls" encountered during the build process and the corresponding architectural decisions, aiming to inspire fellow developers wrestling with Electron.

## 1. üçé macOS Build: The Story of Security-Scoped Bookmarks

When building for the Mac App Store (MAS), the biggest challenge came from Apple's strict Sandbox mechanism.

### Problem Description
To meet MAS submission requirements, the app must run in a sandboxed environment. However, the sandbox restricts the app's arbitrary access to the file system. Even if the user explicitly selects a folder via `dialog.showOpenDialog`, the app only grants access permission for the current session. Once the app restarts, the permission is lost, preventing the user from reopening the previously added folder.

### Solution
To solve this, we implemented **Security-Scoped Bookmarks**.

1.  **Save Bookmark on Permission Grant**: When the user selects a folder, use Electron's API to obtain the `bookmark` (an encrypted data string generated by the macOS system) for that path.
2.  **Persistent Storage**: Store this `bookmark` string in a local database (such as LowDB).
3.  **Restore Permission on Restart**: When the app launches, read the stored `bookmark` and call `app.startAccessingSecurityScopedResource` to reactivate access permissions.

This mechanism ensures that users can seamlessly access their note library after restarting the app, satisfying both security requirements and user experience. In v1.2.4, we finally completely fixed the folder permission issue in the MAS version.

## 2. ü™ü Windows Build: Reluctantly Dropping WebLLM

Compared to the permission struggle on macOS, the challenge on Windows lay more in performance and architectural choices.

### Architectural Decision
In the Windows version of v1.2.4, we made a tough decision: **Remove built-in WebLLM engine support.**

### Analysis
1.  **Performance Bottleneck**: WebLLM relies on WebGPU technology to run large models in the browser environment. While it performs acceptably on macOS (especially with Apple Silicon chips), on Windows, due to vastly different hardware configurations and complex driver compatibility, WebLLM suffered from slow loading speeds, high inference latency, and even crashes on many mid-to-low-end machines.
2.  **User Experience**: Sacrificing the overall smoothness and stability of the app to maintain an unstable feature is not worth it. Users expect an "out-of-the-box" tool that responds quickly, not an experimental product that requires a long wait to load.
3.  **Alternative**: We strongly recommend Windows users use **Ollama**. As an independent local inference engine, Ollama runs very stably and efficiently on Windows. It not only supports more models (such as Llama 3, Qwen 2.5, etc.) but also controls resource usage better.

### Conclusion
Although we lost the selling point of a "built-in engine," guiding users to use the more mature Ollama architecture actually improves the final productivity experience. Architectural choices are often like this; there is no absolute perfection, only the most suitable trade-off for a specific scenario.

---

*The above is not just a technical record but also a step towards a more mature and stable WitNote. Thanks to every user for your tolerance and feedback.*
